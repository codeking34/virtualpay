<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles2.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet">
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">

    <title>Users</title>

</head>
<body class="body">
    <section class="header">
        <div class="logo">
            <i class="ri-menu-line menu"></i>
            <h2><span>Virtual</span> PayCm</h2>
        </div>
        <div class="header--items">
            <i class="ri-search-2-line"></i>
            <div class="dark--theme--btn">
                <i class="ri-moon-line moon"></i>
                <i class="ri-sun-line sun"></i>
            </div>
            <i class="ri-notification-2-line"></i>
            <i class="ri-wechat-2-line chat"></i>
            <div class="profile">
                <img src="assets/images/profile.jpg" alt="">
            </div>
        </div>
    </section>
    <section class="main">
        <div class="sidebar">
            <ul class="sidebar--items">
               <span id="userid" class="w3-tag"></span>
                <span id="email" class="w3-text-teal"></span>

                <li>
                    <a href="#" class="active">
                        <span class="icon"><i class="ri-bar-chart-line"></i></span>
                        <div class="sidebar--item">Overview</div>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <span class="icon"><i class="ri-handbag-line"></i></span>
                        <div class="sidebar--item">Product</div>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <span class="icon"><i class="ri-user-line"></i></span>
                        <div class="sidebar--item">Customers</div>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <span class="icon"><i class="ri-booklet-line"></i></span>
                        <div class="sidebar--item">Orders</div>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <span class="icon"><i class="ri-shopping-cart-2-line"></i></span>
                        <div class="sidebar--item">Checkout</div>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <span class="icon"><i class="ri-settings-3-line"></i></span>
                        <div class="sidebar--item">Settings</div>
                    </a>
                </li>
            </ul>
            <ul class="sidebar--bottom--items">
                <li>
                    <a href="#">
                        <span class="icon"><i class="ri-question-line"></i></span>
                        <div class="sidebar--item">Help</div>
                    </a>
                </li>
                <li>
                    <a href="#">
                        <span class="icon"><i class="ri-logout-box-r-line"></i></span>
                        <div class="sidebar--item"><a href="index.html" style="text-decoration:none;">Logout</a></div>
                    </a>
                </li>
            </ul>
        </div>
        <div class="main--container">
            <div class="section--title">
                <h5 class="title">Welcome back, <span id="username"></span></h5>
                <select name="date" id="date">
                    <option value="last7">Last 7 days</option>
                    <option value="lastmonth">Last month</option>
                    <option value="lastyear">Last year</option>
                    <option value="alltime">All time</option>
                </select>
            </div>
            <div class="cards">
                <div class="card card-1">
                    <div class="card--title">
                        <span class="card--icon icon"><i class="ri-shopping-bag-2-line"></i></span>
                        <span>Sales</span>
                    </div>
                    <h3 class="card--value">$432,576.34 <i class="ri-arrow-up-circle-fill up"></i></h3>
                    <h5 class="more">4,234 more than usual</h5>
                    <div class="chart">
                        <canvas id="sales"></canvas>
                    </div>
                </div>
                <div class="card card-2">
                    <div class="card--title">
                        <span class="card--icon icon"><i class="ri-gift-line"></i></span>
                        <span>Orders</span>
                    </div>
                    <h3 class="card--value">2,567 <i class="ri-arrow-down-circle-fill down"></i></h3>
                    <h5 class="less">234 less than usual</h5>
                    <div class="chart">
                        <canvas id="orders"></canvas>
                    </div>
                </div>
                <div class="card card-3">
                    <div class="card--title">
                        <span class="card--icon icon"><i class="ri-handbag-line"></i></span>
                        <span>Products</span>
                    </div>
                    <h3 class="card--value">587 <i class="ri-arrow-up-circle-fill up"></i></h3>
                    <h5 class="more">23 more than usual</h5>
                    <div class="chart">
                        <canvas id="products"></canvas>
                    </div>
                </div>
                <div class="card card-4">
                    <div class="card--title">
                        <span class="card--icon icon"><i class="ri-user-line"></i></span>
                        <span>Customers</span>
                    </div>
                    <h3 class="card--value">4,300 <i class="ri-arrow-down-circle-fill down"></i></h3>
                    <h5 class="less">34 less than usual</h5>
                    <div class="chart">
                        <canvas id="customers"></canvas>
                    </div>
                </div>
            </div>
            <div class="target-vs-sales--container">
                <div class="section--title">
                    <h3 class="title">card Rate 2024 </h3>
                    <div class="sales--value">
                        <div class="target">
                            <i class="ri-checkbox-blank-circle-fill circle"></i>
                            Premium <span>&nbsp; sales</span>
                        </div>
                        <div class="current">
                            <i class="ri-checkbox-blank-circle-fill circle"></i>
                            standard <span>&nbsp; sales</span>
                        </div>
                    </div>
                </div>
                <div class="target--vs--sales">
                    <canvas id="tarsale"></canvas>
                </div>
            </div>
           
            </div>
        </div>
    </section>
    <script src="main.js"></script>
    <script src="sales.js"></script>
    <script src="orders.js"></script>
    <script src="products.js"></script>
    <script src="customers.js"></script>
    <script src="tarsale.js"></script>
</body>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";
    import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDC7n9YyHLAIwxIr86T1Z6R_bi2fiyPlG4",
        authDomain: "instagram-page-6a449.firebaseapp.com",
        databaseURL: "https://instagram-page-6a449-default-rtdb.firebaseio.com",
        projectId: "instagram-page-6a449",
        storageBucket: "instagram-page-6a449.appspot.com",
        messagingSenderId: "490527916378",
        appId: "1:490527916378:web:c290f53fc48cbe71673363"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const database = getDatabase(app);

    // Function to fetch and store user data in session storage
    function fetchAndStoreUserData(uid) {
        const userRef = ref(database, 'users/' + uid);
        
        get(userRef).then((snapshot) => {
            if (snapshot.exists()) {
                const userData = snapshot.val();
                
                // Store user data in session storage
                sessionStorage.setItem("userData", JSON.stringify(userData));
                
                // Display the data
                displayUserData(userData, uid);
            } else {
                console.log("No user data found in database.");
                displayUserData({ username: "No user data", email: "No user data" }, uid);
            }
        }).catch((error) => {
            console.error("Error fetching user data:", error);
        });
    }

    // Function to display user data
    function displayUserData(userData, uid) {
        document.getElementById('userid').textContent = uid;
        document.getElementById('username').textContent = userData.username || 'No Username';
        document.getElementById('email').textContent = userData.email || 'No Email';
    }

    // Check if user is logged in and retrieve data from session storage
    onAuthStateChanged(auth, (user) => {
        if (user) {
            const uid = user.uid;

            // Check if user data is already in session storage
            const storedData = sessionStorage.getItem("userData");
            if (storedData) {
                console.log("Using cached user data.");
                displayUserData(JSON.parse(storedData), uid);
            } else {
                console.log("Fetching user data from Firebase.");
                fetchAndStoreUserData(uid);
            }
        } else {
            // Redirect to login page if user is not logged in
            window.location.href = 'index.html';
        }
    });
</script>

</html>
